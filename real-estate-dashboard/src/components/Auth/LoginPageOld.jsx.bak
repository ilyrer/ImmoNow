import React, { useMemo, useState, useEffect } from 'react';
import { motion, AnimatePresence, useAnimation } from 'framer-motion';
import AuroraBackground from './AuroraBackground';
import TopProgressBar from '../common/TopProgressBar';
import SuccessOverlay from '../common/SuccessOverlay';
import { useLogin } from '../../hooks/useApi';
import { useForgotPassword, usePlans, useCheckout } from '../../hooks/useApi';
import PlanSelector from './PlanSelector';
import { authService } from '../../api/services';
import { toast } from 'react-hot-toast';
import PasswordStrength from './PasswordStrength';
// Navigation is triggered via window.location.assign to avoid Router context issues after unmount

const LoginPage = ({ onLogin }) => {
  const [isLogin, setIsLogin] = useState(true);
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    password: '',
    confirmPassword: '',
    company: '',
    plan: 'starter'
  });}
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showSuccess, setShowSuccess] = useState(false);
  const [focusedField, setFocusedField] = useState(null);
  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });
  const [isLoading, setIsLoading] = useState(true);
  
  const controls = useAnimation();

  // Premium loading animation
  useEffect(() => {
    const timer = setTimeout(() => {
      setIsLoading(false);
      controls.start("visible");
    }, 800);
    return () => clearTimeout(timer);
  }, [controls]);

  // Mouse tracking for interactive effects
  useEffect(() => {
    const handleMouseMove = (e) => {
      setMousePosition({ x: e.clientX, y: e.clientY });
    };
    window.addEventListener('mousemove', handleMouseMove);
    return () => window.removeEventListener('mousemove', handleMouseMove);
  }, []);

  const loginMutation = useLogin({
    onSuccess: (data) => {
      onLogin(data.user);
      toast.success('Erfolgreich angemeldet!');
    },
    onError: (error) => {
      toast.error(`Login fehlgeschlagen: ${error.message}`);
    }
  });
  const forgotPw = useForgotPassword();

  const { data: plansData } = usePlans();
  const checkout = useCheckout();
  const plans = (plansData?.plans || []).map(p => ({
    id: p.id,
    name: p.id.charAt(0).toUpperCase() + p.id.slice(1),
    price: (p.price_cents/100).toFixed(2),
    features: p.features || [],
    popular: p.id === 'premium' || p.id === 'pro',
  }));

  const brandGradient = useMemo(() => 'from-indigo-900 via-purple-900 to-pink-900', []);
  
  // Enhanced animations
  const containerVariants = {
    hidden: { 
      opacity: 0, 
      scale: 0.9,
      rotateY: -10
    },
    visible: { 
      opacity: 1, 
      scale: 1,
      rotateY: 0,
      transition: { 
        duration: 1,
        ease: [0.25, 0.46, 0.45, 0.94],
        staggerChildren: 0.1
      } 
    }
  };

  const itemVariants = {
    hidden: { opacity: 0, y: 30, x: -20 },
    visible: { 
      opacity: 1, 
      y: 0, 
      x: 0,
      transition: { duration: 0.6, ease: "easeOut" }
    }
  };

  const floatingVariants = {
    floating: {
      y: [-8, 8, -8],
      rotateY: [-2, 2, -2],
      rotateX: [-1, 1, -1],
      transition: {
        duration: 4,
        repeat: Infinity,
        ease: "easeInOut"
      }
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
  if (isLogin) {
      // Login mit Backend-API
      if (!formData.email || !formData.password) {
        toast.error('Bitte f√ºllen Sie alle Felder aus.');
        return;
      }

      loginMutation.mutate({
        email: formData.email,
        password: formData.password
      }, {
        onSuccess: () => {
          setShowSuccess(true);
          setTimeout(() => setShowSuccess(false), 1400);
        }
      });
    } else {
      if (!formData.name || !formData.email || !formData.password || !formData.confirmPassword || !formData.company) {
        toast.error('Bitte f√ºllen Sie alle Felder aus.');
        return;
      }

      if (formData.password !== formData.confirmPassword) {
        toast.error('Passw√∂rter stimmen nicht √ºberein.');
        return;
      }

      try {
        setIsSubmitting(true);
        const [first, ...rest] = String(formData.name).trim().split(' ');
        const payload = {
          email: formData.email,
          password: formData.password,
          first_name: first || formData.email.split('@')[0],
          last_name: rest.join(' '),
          company: formData.company,
          plan: formData.plan,
          billing_cycle: 'monthly',
        };
  const data = await authService.register(payload);
  if (data?.access_token) localStorage.setItem('access_token', data.access_token);
  if (data?.refresh_token) localStorage.setItem('refresh_token', data.refresh_token);
        onLogin(data.user);
        toast.success('Registrierung erfolgreich ‚Äì Willkommen!');
        // Show a small inline banner (imperative toast) suggesting subscription
        toast((t) => (
          <div className="text-sm">
            <div className="font-medium mb-1">Abo abschlie√üen</div>
            <div className="mb-2">Starten Sie jetzt den Checkout f√ºr Ihren gew√§hlten Plan.</div>
            <div className="flex gap-2">
               <button onClick={async () => { try { const res = await checkout.mutateAsync({ plan: formData.plan, billing_cycle: 'monthly' }); if (res?.session_url) { window.location.href = res.session_url; } else if (res && res.subscription_id) { const q = new URLSearchParams({ subscription_id: String(res.subscription_id), invoice_id: String(res.invoice_id || ''), status: String(res.status || 'open') }); window.location.assign(`/subscription/success?${q.toString()}`); } toast.dismiss(t.id); } catch(_){} }} className="px-3 py-1 rounded bg-indigo-600 text-white">Checkout starten</button>
              <a href="/subscription" onClick={() => toast.dismiss(t.id)} className="px-3 py-1 rounded bg-gray-200 text-gray-800">Sp√§ter</a>
            </div>
          </div>
        ), { duration: 8000 });
        // Optional: start checkout for the chosen plan
        try {
          if (formData.plan) {
            const res = await checkout.mutateAsync({ plan: formData.plan, billing_cycle: 'monthly' });
            if (res?.session_url) {
              window.location.href = res.session_url;
            } else if (res && res.subscription_id) {
              const q = new URLSearchParams({
                subscription_id: String(res.subscription_id),
                invoice_id: String(res.invoice_id || ''),
                status: String(res.status || 'open'),
              });
              window.location.assign(`/subscription/success?${q.toString()}`);
            }
          }
        } catch (_) { /* non-blocking */ }
      } catch (err) {
        const msg = err?.response?.data?.detail || err?.message || 'Registrierung fehlgeschlagen';
        toast.error(String(msg));
      } finally {
        setIsSubmitting(false);
      }
    }
  };

  const handleInputChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
  };

  return (
    <div className="min-h-screen relative overflow-hidden">
      <TopProgressBar active={loginMutation.isPending || isSubmitting} />
      
      {/* Premium Background with Advanced Gradients */}
      <div className="absolute inset-0 bg-gradient-to-br from-slate-900 via-purple-900 via-indigo-900 to-slate-900">
        {/* Enhanced Aurora Background */}
        <AuroraBackground />
        
        {/* Noise Texture Overlay */}
        <div className="absolute inset-0 opacity-10 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZmlsdGVyIGlkPSJub2lzZSI+CiAgICA8ZmVUdXJidWxlbmNlIGJhc2VGcmVxdWVuY3k9IjAuOSIgbnVtT2N0YXZlcz0iMyIgc3RpdGNoVGlsZXM9InN0aXRjaCIvPgogIDwvZmlsdGVyPgogIDxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWx0ZXI9InVybCgjbm9pc2UpIiBvcGFjaXR5PSIwLjQiLz4KPC9zdmc+')]"></div>
        
        {/* Geometric Patterns */}
        <div className="absolute inset-0">
          <svg className="absolute top-10 left-10 w-32 h-32 text-white/5" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="40" fill="none" stroke="currentColor" strokeWidth="0.5"/>
            <circle cx="50" cy="50" r="25" fill="none" stroke="currentColor" strokeWidth="0.3"/>
            <circle cx="50" cy="50" r="10" fill="none" stroke="currentColor" strokeWidth="0.2"/>
          </svg>
          <svg className="absolute bottom-20 right-20 w-24 h-24 text-white/5" viewBox="0 0 100 100">
            <polygon points="50,10 90,90 10,90" fill="none" stroke="currentColor" strokeWidth="0.3"/>
          </svg>
        </div>
      </div>

      {/* Main Container with Perspective */}
      <div className="relative z-10 min-h-screen flex items-center justify-center p-4 perspective-1000">

      {/* Premium Loading Overlay */}
      <AnimatePresence>
        {isLoading && (
          <motion.div
            initial={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.8 }}
            className="fixed inset-0 bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center z-50"
          >
            <motion.div
              animate={{ rotate: 360 }}
              transition={{ duration: 2, repeat: Infinity, ease: "linear" }}
              className="w-16 h-16 border-4 border-purple-500/30 border-t-purple-400 rounded-full"
            />
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.2 }}
              className="absolute mt-32 text-white/70 text-sm font-light tracking-wider"
            >
              Preparing Premium Experience...
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* Main Content */}
      <motion.div
        variants={containerVariants}
        initial="hidden"
        animate={controls}
        className="relative z-10 w-full max-w-7xl perspective-1000"
      >
        {/* Premium Glass Panel */}
        <motion.div 
          variants={floatingVariants}
          animate="floating"
          className="relative bg-white/[0.03] backdrop-blur-3xl rounded-3xl shadow-2xl border border-white/10 overflow-hidden transform-gpu"
          style={{
            background: `radial-gradient(600px circle at ${mousePosition.x}px ${mousePosition.y}px, rgba(255,255,255,0.06), transparent 40%)`
          }}
        >
          {/* Animated border glow */}
          <motion.div 
            className="absolute inset-0 rounded-3xl"
            animate={{
              boxShadow: [
                '0 0 20px rgba(168, 85, 247, 0.4)',
                '0 0 40px rgba(59, 130, 246, 0.4)',
                '0 0 20px rgba(168, 85, 247, 0.4)'
              ]
            }}
            transition={{ duration: 4, repeat: Infinity }}
          />
          
          <div className="flex flex-col xl:flex-row min-h-[700px]">
            {/* Left Side - Premium Branding */}
            <motion.div 
              variants={itemVariants}
              className={`xl:w-1/2 p-8 lg:p-16 bg-gradient-to-br ${brandGradient} relative overflow-hidden`}
            >
              {/* Dynamic background elements */}
              <div className="absolute inset-0">
                <motion.div 
                  className="absolute top-20 left-20 w-32 h-32 bg-white/10 rounded-full blur-3xl"
                  animate={{
                    scale: [1, 1.2, 1],
                    opacity: [0.3, 0.5, 0.3]
                  }}
                  transition={{ duration: 4, repeat: Infinity }}
                />
                <motion.div 
                  className="absolute bottom-20 right-20 w-24 h-24 bg-purple-400/20 rounded-full blur-2xl"
                  animate={{
                    scale: [1.2, 1, 1.2],
                    opacity: [0.2, 0.4, 0.2]
                  }}
                  transition={{ duration: 6, repeat: Infinity }}
                />
              </div>

              <div className="flex flex-col h-full justify-center relative z-10">
                <div className="text-center xl:text-left">
                  {/* Premium Logo with animation */}
                  <motion.div
                    initial={{ opacity: 0, scale: 0.8 }}
                    animate={{ opacity: 1, scale: 1 }}
                    transition={{ delay: 0.5, duration: 0.8 }}
                  >
                    <img 
                      src="/logo/logo-removebg-preview.png" 
                      alt="Weltberg Immobilien" 
                      className="h-20 w-auto mx-auto xl:mx-0 mb-8 drop-shadow-2xl"
                    />
                  </motion.div>

                  {/* Hero Content with enhanced animations */}
                  <motion.div
                    variants={itemVariants}
                    className="mb-12"
                  >
                    <motion.h1 
                      className="text-4xl xl:text-5xl font-black text-white mb-6 leading-tight tracking-tight"
                      initial={{ opacity: 0, y: 30 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.7, duration: 0.8 }}
                    >
                      <span className="bg-gradient-to-r from-white via-purple-200 to-white bg-clip-text text-transparent">
                        Die Zukunft des
                      </span>
                      <br />
                      <span className="bg-gradient-to-r from-purple-200 via-pink-200 to-purple-200 bg-clip-text text-transparent">
                        Immobilienmanagements
                      </span>
                    </motion.h1>
                    
                    <motion.p 
                      className="text-xl text-purple-100/90 mb-3 font-light"
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      transition={{ delay: 1, duration: 0.8 }}
                    >
                      Revolution√§re KI-gest√ºtzte Plattform f√ºr Premium-Immobilienerfahrungen
                    </motion.p>
                    
                    <motion.p 
                      className="text-lg text-indigo-200/80 font-extralight"
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      transition={{ delay: 1.2, duration: 0.8 }}
                    >
                      Maximale Effizienz. Minimaler Aufwand. Maximaler Erfolg.
                    </motion.p>
                  </motion.div>

                  {/* Premium Features */}
                  <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 1.4, duration: 0.8 }}
                    className="space-y-6 text-purple-100"
                  >
                    {[
                      { icon: "‚ú®", title: "KI-gest√ºtzte Marktanalysen", desc: "Predictive Analytics f√ºr optimale Entscheidungen" },
                      { icon: "üöÄ", title: "Automatisierte Workflows", desc: "99% weniger manueller Aufwand" },
                      { icon: "üíé", title: "Premium Dashboard", desc: "Real-time Insights und Performance Tracking" },
                      { icon: "üéØ", title: "Smart Lead Management", desc: "Conversion-Rate um 400% gesteigert" }
                    ].map((feature, index) => (
                      <motion.div
                        key={feature.title}
                        initial={{ opacity: 0, x: -20 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 1.6 + index * 0.1, duration: 0.6 }}
                        className="flex items-start space-x-4 group"
                      >
                        <motion.div
                          className="text-2xl"
                          animate={{ rotate: [0, 5, 0] }}
                          transition={{ duration: 2, repeat: Infinity, delay: index * 0.2 }}
                        >
                          {feature.icon}
                        </motion.div>
                        <div>
                          <h3 className="font-semibold text-white mb-1">{feature.title}</h3>
                          <p className="text-sm text-purple-200/70 font-light">{feature.desc}</p>
                        </div>
                      </motion.div>
                    ))}
                  </motion.div>
                </div>
              </div>
            </motion.div>

            {/* Right Side - Enhanced Login Form */}
            <motion.div 
              variants={itemVariants}
              className="xl:w-1/2 p-8 lg:p-16 relative"
            >
              {/* Ambient light effect */}
              <div className="absolute inset-0 bg-gradient-to-br from-white/[0.02] via-transparent to-purple-500/[0.02]" />
              
              <div className="max-w-md mx-auto relative z-10">
                {/* Premium Form Header */}
                <motion.div 
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.8, duration: 0.6 }}
                  className="mb-10 text-center"
                >
                  <h2 className="text-3xl font-bold bg-gradient-to-r from-white via-purple-200 to-white bg-clip-text text-transparent mb-3">
                    {isLogin ? 'Welcome Back' : 'Join the Elite'}
                  </h2>
                  <p className="text-purple-200/70 font-light">
                    {isLogin ? 'Continue your premium journey' : 'Start your transformation today'}
                  </p>
                </motion.div>

                {/* Enhanced Toggle */}
                <motion.div 
                  className="flex bg-white/5 backdrop-blur-xl rounded-2xl p-1 mb-10 border border-white/10"
                  initial={{ opacity: 0, scale: 0.9 }}
                  animate={{ opacity: 1, scale: 1 }}
                  transition={{ delay: 1, duration: 0.6 }}
                >
                  <motion.button
                    type="button"
                    onClick={() => setIsLogin(true)}
                    className={`flex-1 py-3 px-6 rounded-xl text-sm font-medium transition-all duration-300 ${
                      isLogin 
                        ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg shadow-purple-500/25' 
                        : 'text-purple-200 hover:text-white hover:bg-white/5'
                    }`}
                    whileHover={{ scale: 1.02 }}
                    whileTap={{ scale: 0.98 }}
                  >
                    Sign In
                  </motion.button>
                  <motion.button
                    type="button"
                    onClick={() => setIsLogin(false)}
                    className={`flex-1 py-3 px-6 rounded-xl text-sm font-medium transition-all duration-300 ${
                      !isLogin 
                        ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg shadow-purple-500/25' 
                        : 'text-purple-200 hover:text-white hover:bg-white/5'
                    }`}
                    whileHover={{ scale: 1.02 }}
                    whileTap={{ scale: 0.98 }}
                  >
                    Create Account
                  </motion.button>
                </motion.div>

                {/* Premium Login Form */}
                <form onSubmit={handleSubmit} className="space-y-6">
                  {/* Name Field (Registration only) */}
                  {!isLogin && (
                    <motion.div
                      initial={{ opacity: 0, height: 0 }}
                      animate={{ opacity: 1, height: 'auto' }}
                      exit={{ opacity: 0, height: 0 }}
                      transition={{ duration: 0.3 }}
                    >
                      <label htmlFor="name" className="block text-sm font-medium text-purple-200 mb-2">
                        Full Name
                      </label>
                      <div className="relative">
                        <motion.div
                          className={`absolute inset-0 rounded-xl bg-gradient-to-r from-purple-500/20 to-pink-500/20 transition-opacity duration-300 ${
                            focusedField === 'name' ? 'opacity-100' : 'opacity-0'
                          }`}
                        />
                        <div className="relative">
                          <span className="absolute left-4 top-1/2 -translate-y-1/2 text-purple-300/60">
                            <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                              <path d="M12 12a5 5 0 100-10 5 5 0 000 10zm7 9a1 1 0 01-1 1H6a1 1 0 01-1-1 7 7 0 0114 0z"/>
                            </svg>
                          </span>
                          <input
                            type="text"
                            id="name"
                            name="name"
                            value={formData.name}
                            onChange={handleInputChange}
                            onFocus={() => setFocusedField('name')}
                            onBlur={() => setFocusedField(null)}
                            className="w-full pl-12 pr-4 py-4 bg-white/5 border border-white/10 rounded-xl text-white placeholder-purple-300/50 focus:border-purple-400/50 focus:bg-white/[0.08] transition-all duration-300 backdrop-blur-xl"
                            placeholder="Your full name"
                            required
                          />
                        </div>
                      </div>
                    </motion.div>
                  )}

                  {/* Email Field */}
                  <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 1.2, duration: 0.6 }}
                  >
                    <label htmlFor="email" className="block text-sm font-medium text-purple-200 mb-2">
                      Email Address
                    </label>
                    <div className="relative">
                      <motion.div
                        className={`absolute inset-0 rounded-xl bg-gradient-to-r from-purple-500/20 to-pink-500/20 transition-opacity duration-300 ${
                          focusedField === 'email' ? 'opacity-100' : 'opacity-0'
                        }`}
                      />
                      <div className="relative">
                        <span className="absolute left-4 top-1/2 -translate-y-1/2 text-purple-300/60">
                          <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M20 4H4a2 2 0 00-2 2v12a2 2 0 002 2h16a2 2 0 002-2V6a2 2 0 00-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                          </svg>
                        </span>
                        <input
                          type="email"
                          id="email"
                          name="email"
                          value={formData.email}
                          onChange={handleInputChange}
                          onFocus={() => setFocusedField('email')}
                          onBlur={() => setFocusedField(null)}
                          className="w-full pl-12 pr-4 py-4 bg-white/5 border border-white/10 rounded-xl text-white placeholder-purple-300/50 focus:border-purple-400/50 focus:bg-white/[0.08] transition-all duration-300 backdrop-blur-xl"
                          placeholder="your@email.com"
                          required
                          autoComplete="email"
                        />
                      </div>
                    </div>
                  </motion.div>

                  {/* Password Field */}
                  <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 1.4, duration: 0.6 }}
                  >
                    <label htmlFor="password" className="block text-sm font-medium text-purple-200 mb-2">
                      Password
                    </label>
                    <div className="relative">
                      <motion.div
                        className={`absolute inset-0 rounded-xl bg-gradient-to-r from-purple-500/20 to-pink-500/20 transition-opacity duration-300 ${
                          focusedField === 'password' ? 'opacity-100' : 'opacity-0'
                        }`}
                      />
                      <div className="relative">
                        <input
                          type={showPassword ? 'text' : 'password'}
                          id="password"
                          name="password"
                          value={formData.password}
                          onChange={handleInputChange}
                          onFocus={() => setFocusedField('password')}
                          onBlur={() => setFocusedField(null)}
                          className="w-full px-4 py-4 pr-12 bg-white/5 border border-white/10 rounded-xl text-white placeholder-purple-300/50 focus:border-purple-400/50 focus:bg-white/[0.08] transition-all duration-300 backdrop-blur-xl"
                          placeholder="Your secure password"
                          required
                          autoComplete={isLogin ? 'current-password' : 'new-password'}
                        />
                        <motion.button
                          type="button"
                          onClick={() => setShowPassword(!showPassword)}
                          className="absolute right-4 top-1/2 -translate-y-1/2 text-purple-300/60 hover:text-purple-200 transition-colors"
                          whileHover={{ scale: 1.1 }}
                          whileTap={{ scale: 0.9 }}
                        >
                          <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            {showPassword ? (
                              <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                            ) : (
                              <path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
                            )}
                          </svg>
                        </motion.button>
                      </div>
                    </div>
                  </motion.div>

                  {/* Registration Additional Fields */}
                  {!isLogin && (
                    <AnimatePresence>
                      {/* Confirm Password */}
                      <motion.div
                        initial={{ opacity: 0, height: 0 }}
                        animate={{ opacity: 1, height: 'auto' }}
                        exit={{ opacity: 0, height: 0 }}
                        transition={{ duration: 0.3, delay: 0.1 }}
                      >
                        <label htmlFor="confirmPassword" className="block text-sm font-medium text-purple-200 mb-2">
                          Confirm Password
                        </label>
                        <div className="relative">
                          <motion.div
                            className={`absolute inset-0 rounded-xl bg-gradient-to-r from-purple-500/20 to-pink-500/20 transition-opacity duration-300 ${
                              focusedField === 'confirmPassword' ? 'opacity-100' : 'opacity-0'
                            }`}
                          />
                          <div className="relative">
                            <input
                              type={showConfirmPassword ? 'text' : 'password'}
                              id="confirmPassword"
                              name="confirmPassword"
                              value={formData.confirmPassword}
                              onChange={handleInputChange}
                              onFocus={() => setFocusedField('confirmPassword')}
                              onBlur={() => setFocusedField(null)}
                              className="w-full px-4 py-4 pr-12 bg-white/5 border border-white/10 rounded-xl text-white placeholder-purple-300/50 focus:border-purple-400/50 focus:bg-white/[0.08] transition-all duration-300 backdrop-blur-xl"
                              placeholder="Confirm your password"
                              required
                              autoComplete="new-password"
                            />
                            <motion.button
                              type="button"
                              onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                              className="absolute right-4 top-1/2 -translate-y-1/2 text-purple-300/60 hover:text-purple-200 transition-colors"
                              whileHover={{ scale: 1.1 }}
                              whileTap={{ scale: 0.9 }}
                            >
                              <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                {showConfirmPassword ? (
                                  <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                ) : (
                                  <path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
                                )}
                              </svg>
                            </motion.button>
                          </div>
                        </div>
                        <div className="mt-2">
                          <PasswordStrength value={formData.password} />
                        </div>
                      </motion.div>

                      {/* Company Field */}
                      <motion.div
                        initial={{ opacity: 0, height: 0 }}
                        animate={{ opacity: 1, height: 'auto' }}
                        exit={{ opacity: 0, height: 0 }}
                        transition={{ duration: 0.3, delay: 0.2 }}
                      >
                        <label htmlFor="company" className="block text-sm font-medium text-purple-200 mb-2">
                          Company Name
                        </label>
                        <div className="relative">
                          <motion.div
                            className={`absolute inset-0 rounded-xl bg-gradient-to-r from-purple-500/20 to-pink-500/20 transition-opacity duration-300 ${
                              focusedField === 'company' ? 'opacity-100' : 'opacity-0'
                            }`}
                          />
                          <div className="relative">
                            <span className="absolute left-4 top-1/2 -translate-y-1/2 text-purple-300/60">
                              <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M3 21V7a2 2 0 012-2h3V3h8v2h3a2 2 0 012 2v14h-6v-5h-6v5H3zm8-12h2V7h-2v2z"/>
                              </svg>
                            </span>
                            <input
                              type="text"
                              id="company"
                              name="company"
                              value={formData.company}
                              onChange={handleInputChange}
                              onFocus={() => setFocusedField('company')}
                              onBlur={() => setFocusedField(null)}
                              className="w-full pl-12 pr-4 py-4 bg-white/5 border border-white/10 rounded-xl text-white placeholder-purple-300/50 focus:border-purple-400/50 focus:bg-white/[0.08] transition-all duration-300 backdrop-blur-xl"
                              placeholder="Your company name"
                              required
                              autoComplete="organization"
                            />
                          </div>
                        </div>
                      </motion.div>

                      {/* Premium Plan Selection */}
                      <motion.div
                        initial={{ opacity: 0, height: 0 }}
                        animate={{ opacity: 1, height: 'auto' }}
                        exit={{ opacity: 0, height: 0 }}
                        transition={{ duration: 0.3, delay: 0.3 }}
                      >
                        <label className="block text-sm font-medium text-purple-200 mb-3">
                          Choose Your Premium Plan
                        </label>
                        <div className="bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 p-4">
                          <PlanSelector 
                            value={formData.plan} 
                            onChange={(v) => setFormData({ ...formData, plan: v })} 
                          />
                        </div>
                      </motion.div>
                    </AnimatePresence>
                  )}

                  {/* Premium Submit Button */}
                  <motion.button
                    type="submit"
                    disabled={loginMutation.isPending || isSubmitting}
                    className="w-full relative overflow-hidden bg-gradient-to-r from-purple-600 via-pink-600 to-purple-700 text-white py-4 px-8 rounded-xl font-semibold text-lg shadow-2xl shadow-purple-500/25 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-purple-500/50 group"
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: 1.6, duration: 0.6 }}
                    whileHover={{ 
                      scale: 1.02, 
                      boxShadow: "0 20px 40px -12px rgba(168, 85, 247, 0.4)"
                    }}
                    whileTap={{ scale: 0.98 }}
                  >
                    {/* Button glow effect */}
                    <motion.div
                      className="absolute inset-0 bg-gradient-to-r from-purple-400/20 via-pink-400/20 to-purple-400/20 rounded-xl"
                      animate={{
                        opacity: [0, 1, 0],
                        scale: [0.8, 1.2, 0.8],
                      }}
                      transition={{
                        duration: 2,
                        repeat: Infinity,
                        ease: "easeInOut"
                      }}
                    />
                    
                    {loginMutation.isPending || isSubmitting ? (
                      <div className="flex items-center justify-center space-x-2">
                        <motion.div
                          animate={{ rotate: 360 }}
                          transition={{ duration: 1, repeat: Infinity, ease: "linear" }}
                          className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full"
                        />
                        <span>{isLogin ? 'Signing you in...' : 'Creating your account...'}</span>
                      </div>
                    ) : (
                      <span className="relative z-10 flex items-center justify-center space-x-2">
                        <span>{isLogin ? 'Enter Premium Dashboard' : 'Start Premium Journey'}</span>
                        <motion.svg 
                          className="w-5 h-5"
                          fill="currentColor"
                          viewBox="0 0 24 24"
                          initial={{ x: 0 }}
                          animate={{ x: [0, 4, 0] }}
                          transition={{ duration: 1.5, repeat: Infinity, ease: "easeInOut" }}
                        >
                          <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/>
                        </motion.svg>
                      </span>
                    )}
                  </motion.button>

                  {/* Enhanced Social Login */}
                  <div className="pt-6">
                    <div className="relative text-center">
                      <div className="absolute inset-0 flex items-center">
                        <div className="w-full border-t border-white/10"></div>
                      </div>
                      <div className="relative bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 px-4">
                        <span className="text-sm text-purple-300/70">Or continue with</span>
                      </div>
                    </div>
                    
                    <motion.div 
                      className="grid grid-cols-3 gap-4 mt-6"
                      initial={{ opacity: 0, y: 20 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 1.8, duration: 0.6 }}
                    >
                      {[
                        { name: 'Google', icon: GoogleIcon, onClick: () => toast('Google Login coming soon') },
                        { name: 'Microsoft', icon: MicrosoftIcon, onClick: () => toast('Microsoft Login coming soon') },
                        { name: 'Apple', icon: AppleIcon, onClick: () => toast('Apple Login coming soon') }
                      ].map((provider, index) => (
                        <motion.button
                          key={provider.name}
                          type="button"
                          onClick={provider.onClick}
                          className="relative group bg-white/5 backdrop-blur-xl border border-white/10 rounded-xl py-3 px-4 text-sm font-medium text-white hover:bg-white/10 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-purple-500/50"
                          whileHover={{ scale: 1.05, y: -2 }}
                          whileTap={{ scale: 0.95 }}
                          initial={{ opacity: 0, y: 20 }}
                          animate={{ opacity: 1, y: 0 }}
                          transition={{ delay: 1.9 + index * 0.1, duration: 0.4 }}
                        >
                          <div className="flex items-center justify-center space-x-2">
                            <provider.icon />
                            <span>{provider.name}</span>
                          </div>
                          {/* Hover glow */}
                          <motion.div
                            className="absolute inset-0 rounded-xl bg-gradient-to-r from-purple-500/0 via-purple-500/20 to-purple-500/0 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
                          />
                        </motion.button>
                      ))}
                    </motion.div>
                  </div>

                  {/* Forgot Password Link */}
                  {isLogin && (
                    <motion.div 
                      className="text-center"
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      transition={{ delay: 2, duration: 0.6 }}
                    >
                      <motion.button
                        type="button"
                        onClick={async () => {
                          const email = formData.email?.trim();
                          if (!email) {
                            toast.error('Please enter your email address first.');
                            return;
                          }
                          try {
                            await forgotPw.mutateAsync(email);
                            toast.success('If an account exists, a reset email has been sent.');
                          } catch (e) {
                            toast.error('Error requesting password reset');
                          }
                        }}
                        className="text-sm text-purple-300/80 hover:text-purple-200 bg-transparent border-none cursor-pointer transition-colors duration-200"
                        whileHover={{ scale: 1.05 }}
                      >
                        Forgot your password?
                      </motion.button>
                    </motion.div>
                  )}
                </form>

                {/* Footer Switch */}
                <motion.div 
                  className="mt-8 text-center"
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  transition={{ delay: 2.1, duration: 0.6 }}
                >
                  <p className="text-sm text-purple-300/70">
                    {isLogin ? "Don't have an account?" : 'Already have an account?'}{' '}
                    <motion.button
                      type="button"
                      onClick={() => setIsLogin(!isLogin)}
                      className="text-purple-200 hover:text-white font-medium transition-colors duration-200"
                      whileHover={{ scale: 1.05 }}
                    >
                      {isLogin ? 'Create one now' : 'Sign in here'}
                    </motion.button>
                  </p>
                </motion.div>
              </div>
            </motion.div>
          </div>
        </motion.div>
      </motion.div>

      {/* Success Overlay */}
      <SuccessOverlay 
        show={showSuccess} 
        message={isLogin ? 'Welcome back to premium!' : 'Welcome to the elite!'} 
      />
    </div>
  );
};

// Premium Social Icons Components
const GoogleIcon = () => {
  return (
    <svg viewBox="0 0 24 24" className="w-5 h-5">
      <path fill="#EA4335" d="M12 10.2v3.6h5.1c-.2 1.2-1.5 3.6-5.1 3.6-3.1 0-5.7-2.6-5.7-5.7S8.9 6 12 6c1.8 0 3 .8 3.7 1.5l2.5-2.4C16.7 3.7 14.5 3 12 3 6.9 3 2.7 7.2 2.7 12.3S6.9 21.6 12 21.6c6.5 0 9-4.6 9-7 0-.5-.1-1-.2-1.4H12z"/>
    </svg>
  );
};

const MicrosoftIcon = () => {
  return (
    <div className="grid grid-cols-2 grid-rows-2 gap-0.5 w-5 h-5">
      <div className="bg-[#f25022] rounded-sm"></div>
      <div className="bg-[#7fba00] rounded-sm"></div>
      <div className="bg-[#00a4ef] rounded-sm"></div>
      <div className="bg-[#ffb900] rounded-sm"></div>
    </div>
  );
};

const AppleIcon = () => {
  return (
    <svg viewBox="0 0 24 24" className="w-5 h-5" fill="currentColor">
      <path d="M16.365 2c0 1.2-.5 2.3-1.4 3.2-.9.8-2 1.3-3.2 1.2-.1-1 .4-2.1 1.3-3 .9-.9 2.1-1.4 3.3-1.4zM20.9 17.2c-.3.8-.7 1.6-1.2 2.3-.6.8-1.1 1.3-1.4 1.6-.6.5-1.3.7-2 .7-.5 0-1-.1-1.5-.3-.6-.2-1.1-.3-1.7-.3-.6 0-1.1.1-1.7.3-.5.2-1 .3-1.5.3-.7 0-1.4-.2-2-.7-.3-.3-.8-.8-1.4-1.6-.6-.8-1.1-1.6-1.5-2.5-.4-1-.6-2-.6-3 0-1.1.2-2.1.6-3 .4-.9 1-1.7 1.7-2.4.7-.8 1.6-1.2 2.7-1.3.7-.1 1.5 0 2.2.3.5.2 1 .3 1.5.3.5 0 1.1-.1 1.7-.3.6-.2 1.2-.3 1.9-.3 1.1 0 2.1.4 3 .9.7.5 1.2 1.1 1.6 1.8-.7.4-1.3 1-1.8 1.7-.7 1-1 2.1-1 3.3 0 1.2.4 2.2 1 3.2.6 1 1.3 1.8 2.3 2.4z"/>
    </svg>
  );
};

export default LoginPage; 